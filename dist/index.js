"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("dompurify"),n=require("lucide-react");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=o(e),a=o(t),i=function(t){void 0===t&&(t="");var n=e.useState({html:t,plainText:"",wordCount:0}),o=n[0],r=n[1],a=e.useState({range:null,text:""}),i=a[0],l=a[1];return{content:o,selection:i,updateContent:e.useCallback((function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.innerText,o=n.trim().split(/\s+/).length;r({html:e,plainText:n,wordCount:o})}),[]),updateSelection:e.useCallback((function(){var e=window.getSelection();e&&l({range:e.rangeCount>0?e.getRangeAt(0):null,text:e.toString()})}),[])}},l=function(t,n){var o=e.useCallback((function(e){return a.default.sanitize(e,{ALLOWED_TAGS:["p","br","strong","em","u","h1","h2","h3","ul","ol","li","a","img","blockquote","code"],ALLOWED_ATTR:["href","src","alt","class","target","rel"]})}),[]),r=e.useCallback((function(){if(n.range){var e=window.getSelection();null==e||e.removeAllRanges(),null==e||e.addRange(n.range)}}),[n]);return{executeCommand:e.useCallback((function(e,n){var o;if(t.current&&(t.current.focus(),r(),document.execCommand(e,!1,n),"createLink"===e&&n)){var a=window.getSelection(),i=null===(o=null==a?void 0:a.focusNode)||void 0===o?void 0:o.parentElement;"A"===(null==i?void 0:i.tagName)&&(i.setAttribute("target","_blank"),i.setAttribute("rel","noopener noreferrer"))}}),[t,r]),sanitizeHtml:o}},c=function(t,n){var o=e.useState({top:0,left:0}),r=o[0],a=o[1],i=e.useState(!1),l=i[0],c=i[1],d=e.useCallback((function(e){if(e.rangeCount&&"floating"===n){var o=e.getRangeAt(0).getBoundingClientRect(),r=t.current;if(r){var i=r.offsetHeight;a({top:o.top-i-10+window.scrollY,left:o.left+o.width/2}),c(!0)}}}),[t,n]);return e.useEffect((function(){"floating"!==n&&c(!0)}),[n]),{toolbarPos:r,showToolbar:l,setShowToolbar:c,updateToolbarPosition:d}},d=[{id:"text",label:"Text",items:[{id:"bold",label:"Bold",icon:n.Bold,command:"bold"},{id:"italic",label:"Italic",icon:n.Italic,command:"italic"},{id:"underline",label:"Underline",icon:n.Underline,command:"underline"}]},{id:"heading",label:"Heading",items:[{id:"h1",label:"Heading 1",icon:n.Heading1,command:"formatBlock",value:"h1"},{id:"h2",label:"Heading 2",icon:n.Heading2,command:"formatBlock",value:"h2"}]},{id:"alignment",label:"Alignment",items:[{id:"alignLeft",label:"Align Left",icon:n.AlignLeft,command:"justifyLeft"},{id:"alignCenter",label:"Center",icon:n.AlignCenter,command:"justifyCenter"},{id:"alignRight",label:"Align Right",icon:n.AlignRight,command:"justifyRight"}]},{id:"lists",label:"Lists",items:[{id:"bullet",label:"Bullet List",icon:n.List,command:"insertUnorderedList"},{id:"ordered",label:"Numbered List",icon:n.ListOrdered,command:"insertOrderedList"},{id:"quote",label:"Quote",icon:n.Quote,command:"formatBlock",value:"blockquote"}]},{id:"insert",label:"Insert",items:[{id:"link",label:"Link",icon:n.Link2,command:"createLink"},{id:"image",label:"Image",icon:n.Image,command:"insertImage"},{id:"table",label:"Table",icon:n.Table,command:"insertTable"}]}],u=e.forwardRef((function(e,t){var n=e.position,o=void 0===n?"top":n,a=e.style,i=void 0===a?"full":a,l=e.show,c=void 0===l||l,u=e.groups,m=void 0===u?d:u,s=e.activeCommands,f=void 0===s?new Set:s,p=e.onCommand,g=e.customItems,x=void 0===g?[]:g,C=e.className,v=void 0===C?"":C;if(!c)return null;var b="\n    flex flex-wrap items-center gap-2 bg-white border border-gray-200\n    ".concat("floating"===o?"rounded-lg shadow-lg p-2":"p-2 border-t-0 border-x-0","\n    ").concat("compact"===i?"space-x-1":"space-x-2","\n    ").concat(v,"\n  ");return r.default.createElement("div",{ref:t,className:b,role:"toolbar","aria-label":"Text editor toolbar"},m.map((function(e){return r.default.createElement("div",{key:e.id,className:"flex items-center gap-1",role:"group","aria-label":e.label},e.items.map((function(e){var t=e.icon;return r.default.createElement("button",{key:e.id,type:"button",className:"\n                  p-1.5 rounded-md transition-colors\n                  ".concat(f.has(e.command)?"bg-gray-200 text-blue-600":"hover:bg-gray-100 text-gray-700","\n                "),onClick:function(){return t=e.command,n=e.value,void("createLink"!==t?"insertImage"!==t?p(t,n):(o=prompt("Enter image URL:"))&&p(t,o):(o=prompt("Enter URL:"))&&p(t,o));var t,n,o},title:e.label,"aria-pressed":f.has(e.command)},t&&r.default.createElement(t,{size:16}))})),e.id!==m[m.length-1].id&&r.default.createElement("div",{className:"w-px h-6 bg-gray-200 mx-1"}))})),x.length>0&&r.default.createElement(r.default.Fragment,null,r.default.createElement("div",{className:"w-px h-6 bg-gray-200 mx-1"}),r.default.createElement("div",{className:"flex items-center gap-1"},x.map((function(e){var t=e.icon;return r.default.createElement("button",{key:e.id,type:"button",className:"p-1.5 rounded-md hover:bg-gray-100 text-gray-700",onClick:e.onClick,title:e.label},t&&r.default.createElement(t,{size:16}))})))))}));u.displayName="Toolbar";var m=function(){return m=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},m.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var s,f,p,g,x,C=["p","br","strong","em","u","h1","h2","h3","ul","ol","li","a","img","blockquote","code","pre","div","span"],v=["href","src","alt","class","target","rel","style","data-*"],b=["color","background-color","text-align","font-size","font-family","margin","padding"],h={ALLOWED_TAGS:C,ALLOWED_ATTR:v,ALLOWED_STYLES:b,RETURN_DOM:!1,RETURN_DOM_FRAGMENT:!1,RETURN_TRUSTED_TYPE:!1},T=function(e){var t=a.default.sanitize(e,m(m({},h),{RETURN_DOM:!1,RETURN_DOM_FRAGMENT:!1}));return"string"==typeof t?t:""};exports.TextCommand=void 0,(s=exports.TextCommand||(exports.TextCommand={})).BOLD="bold",s.ITALIC="italic",s.UNDERLINE="underline",s.STRIKETHROUGH="strikeThrough",s.SUBSCRIPT="subscript",s.SUPERSCRIPT="superscript",exports.BlockCommand=void 0,(f=exports.BlockCommand||(exports.BlockCommand={})).PARAGRAPH="p",f.H1="h1",f.H2="h2",f.H3="h3",f.H4="h4",f.BLOCKQUOTE="blockquote",f.CODE="pre",exports.AlignCommand=void 0,(p=exports.AlignCommand||(exports.AlignCommand={})).LEFT="justifyLeft",p.CENTER="justifyCenter",p.RIGHT="justifyRight",p.JUSTIFY="justifyFull",exports.ListCommand=void 0,(g=exports.ListCommand||(exports.ListCommand={})).ORDERED="insertOrderedList",g.UNORDERED="insertUnorderedList",exports.FormatCommand=void 0,(x=exports.FormatCommand||(exports.FormatCommand={})).FONT="fontName",x.SIZE="fontSize",x.COLOR="foreColor",x.BACKGROUND="backColor";var E=function(e){return document.queryCommandState(e)},L={paragraph:"p",headings:["h1","h2","h3"],inlineStyles:["bold","italic","underline","strikethrough"],alignment:["justifyLeft","justifyCenter","justifyRight"],lists:["insertUnorderedList","insertOrderedList"]},y=function(t){var n=t.initialContent,o=void 0===n?"":n,a=t.onChange,m=t.onSelectionChange,s=t.onFocus,f=t.onBlur,p=t.toolbar,g=void 0===p?{}:p,x=t.options,C=void 0===x?{}:x,v=t.theme,b=void 0===v?{}:v,h=t.className,E=void 0===h?"":h,L=e.useRef(null),y=e.useRef(null),S=i(o);S.content;var R=S.selection,A=S.updateContent,O=S.updateSelection,w=l(L,R),k=w.executeCommand;w.sanitizeHtml;var F=c(y,g.position||"top"),N=F.toolbarPos,H=F.showToolbar,D=F.setShowToolbar,U=F.updateToolbarPosition;e.useEffect((function(){if(L.current&&o){var e=!1!==C.sanitize?T(o):o;L.current.innerHTML=e,A(e)}}),[o,C.sanitize]);var B=e.useCallback((function(){if(L.current){var e=L.current.innerHTML,t=!1!==C.sanitize?T(e):e;A(t),null==a||a({html:t,plainText:L.current.innerText,wordCount:L.current.innerText.trim().split(/\s+/).length})}}),[a,C.sanitize]),I=e.useCallback((function(){var e=window.getSelection();e&&(O(),null==m||m({range:e.rangeCount>0?e.getRangeAt(0):null,text:e.toString()}),"floating"===g.position&&(e.toString().trim()?U(e):D(!1)))}),[m,g.position]);return r.default.createElement("div",{className:"wysiwyg-editor ".concat(E)},r.default.createElement(u,{ref:y,groups:g.groups||d,customItems:g.customItems,position:g.position,style:g.style,show:H,pos:N,onCommand:k,theme:b.toolbar}),r.default.createElement("div",{ref:L,className:"wysiwyg-content ".concat(b.editor||""),contentEditable:!C.readOnly,onInput:B,onSelect:I,onFocus:s,onBlur:function(e){g.hideOnBlur&&setTimeout((function(){var e;(null===(e=y.current)||void 0===e?void 0:e.contains(document.activeElement))||D(!1)}),100),null==f||f(e)},style:{minHeight:C.minHeight||"200px",maxHeight:C.maxHeight},"data-placeholder":C.placeholder,suppressContentEditableWarning:!0}))},S=u;exports.ALLOWED_ATTR=v,exports.ALLOWED_STYLES=b,exports.ALLOWED_TAGS=C,exports.DEFAULT_FORMATS=L,exports.Editor=y,exports.Toolbar=S,exports.clearFormatting=function(){return document.execCommand("removeFormat",!1)},exports.copySelection=function(){return document.execCommand("copy",!1)},exports.createLink=function(e){var t=e.url,n=e.text,o=e.newWindow,r=void 0===o||o,a=e.rel,i=void 0===a?"noopener noreferrer":a;return n?document.execCommand("insertHTML",!1,'<a href="'.concat(t,'" ').concat(r?'target="_blank"':"",' rel="').concat(i,'">').concat(n,"</a>")):document.execCommand("createLink",!1,t)},exports.createTable=function(e){for(var t=e.rows,n=e.cols,o=e.width,r=void 0===o?"100%":o,a=e.cellPadding,i=void 0===a?"8px":a,l=e.border,c=void 0===l?"1px solid #ccc":l,d='<table style="width: '.concat(r,'; border-collapse: collapse;">'),u=0;u<t;u++){d+="<tr>";for(var m=0;m<n;m++)d+='<td style="padding: '.concat(i,"; border: ").concat(c,';">&nbsp;</td>');d+="</tr>"}return d+="</table>",document.execCommand("insertHTML",!1,d)},exports.cutSelection=function(){return document.execCommand("cut",!1)},exports.formatBlock=function(e){return document.execCommand("formatBlock",!1,"<".concat(e,">"))},exports.formatText=function(e){return document.execCommand(e,!1)},exports.getActiveFormats=function(){var e=new Set;return L.inlineStyles.forEach((function(t){E(t)&&e.add(t)})),L.alignment.forEach((function(t){E(t)&&e.add(t)})),e},exports.getFormatState=function(){var e={textCommands:new Set};return Object.values(exports.TextCommand).forEach((function(t){document.queryCommandState(t)&&e.textCommands.add(t)})),Object.values(exports.AlignCommand).forEach((function(t){document.queryCommandState(t)&&(e.alignCommand=t)})),Object.values(exports.ListCommand).forEach((function(t){document.queryCommandState(t)&&(e.listCommand=t)})),e.fontName=document.queryCommandValue(exports.FormatCommand.FONT),e.fontSize=document.queryCommandValue(exports.FormatCommand.SIZE),e.textColor=document.queryCommandValue(exports.FormatCommand.COLOR),e.backgroundColor=document.queryCommandValue(exports.FormatCommand.BACKGROUND),e},exports.getFormatValue=function(e){return document.queryCommandValue(e)},exports.getSelection=function(){var e=window.getSelection();if(!e||!e.rangeCount)return null;var t=e.getRangeAt(0);return{startOffset:t.startOffset,endOffset:t.endOffset,text:t.toString()}},exports.getSelectionStyles=function(){var e={},t=window.getSelection();if(t&&t.rangeCount>0){var n=t.getRangeAt(0).startContainer.parentElement;if(n){var o=window.getComputedStyle(n);e.fontFamily=o.fontFamily,e.fontSize=o.fontSize,e.color=o.color,e.backgroundColor=o.backgroundColor}}return e},exports.indent=function(){return document.execCommand("indent",!1)},exports.insertLineBreak=function(){return document.execCommand("insertLineBreak",!1)},exports.insertParagraph=function(){return document.execCommand("insertParagraph",!1)},exports.isFormatActive=E,exports.normalizeHtml=function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.querySelectorAll("p").forEach((function(e){var t;(null===(t=e.textContent)||void 0===t?void 0:t.trim())||e.remove()})),t.innerHTML.replace(/\s+/g," ").trim()},exports.outdent=function(){return document.execCommand("outdent",!1)},exports.pasteAsPlainText=function(){var e;return document.execCommand("insertText",!1,(null===(e=event.clipboardData)||void 0===e?void 0:e.getData("text/plain"))||"")},exports.redo=function(){return document.execCommand("redo",!1)},exports.sanitizeConfig=h,exports.sanitizeHtml=T,exports.selectAll=function(){return document.execCommand("selectAll",!1)},exports.setBackgroundColor=function(e){return document.execCommand(exports.FormatCommand.BACKGROUND,!1,e)},exports.setFont=function(e){return document.execCommand(exports.FormatCommand.FONT,!1,e)},exports.setFontSize=function(e){return document.execCommand(exports.FormatCommand.SIZE,!1,e)},exports.setTextColor=function(e){return document.execCommand(exports.FormatCommand.COLOR,!1,e)},exports.undo=function(){return document.execCommand("undo",!1)},exports.useEditorCommands=l,exports.useEditorState=i,exports.useToolbar=c,exports.validateColor=function(e){var t=(new Option).style;return t.color=e,""!==t.color},exports.validateFontSize=function(e){return["px","em","rem","%","pt"].some((function(t){return e.endsWith(t)}))&&!isNaN(parseFloat(e))},exports.validateUrl=function(e){try{return new URL(e),!0}catch(e){return!1}};
//# sourceMappingURL=index.js.map
