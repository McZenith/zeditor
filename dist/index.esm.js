import e,{useState as t,useCallback as n,useEffect as o,forwardRef as r,useRef as i}from"react";import a from"dompurify";import{Bold as c,Italic as l,Underline as u,Heading1 as d,Heading2 as m,AlignLeft as s,AlignCenter as f,AlignRight as g,List as p,ListOrdered as v,Quote as b,Link2 as C,Image as h,Table as x}from"lucide-react";var y=function(e){void 0===e&&(e="");var o=t({html:e,plainText:"",wordCount:0}),r=o[0],i=o[1],a=t({range:null,text:""}),c=a[0],l=a[1];return{content:r,selection:c,updateContent:n((function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.innerText,o=n.trim().split(/\s+/).length;i({html:e,plainText:n,wordCount:o})}),[]),updateSelection:n((function(){var e=window.getSelection();e&&l({range:e.rangeCount>0?e.getRangeAt(0):null,text:e.toString()})}),[])}},E=function(e,t){var o=n((function(e){return a.sanitize(e,{ALLOWED_TAGS:["p","br","strong","em","u","h1","h2","h3","ul","ol","li","a","img","blockquote","code"],ALLOWED_ATTR:["href","src","alt","class","target","rel"]})}),[]),r=n((function(){if(t.range){var e=window.getSelection();null==e||e.removeAllRanges(),null==e||e.addRange(t.range)}}),[t]);return{executeCommand:n((function(t,n){var o;if(e.current&&(e.current.focus(),r(),document.execCommand(t,!1,n),"createLink"===t&&n)){var i=window.getSelection(),a=null===(o=null==i?void 0:i.focusNode)||void 0===o?void 0:o.parentElement;"A"===(null==a?void 0:a.tagName)&&(a.setAttribute("target","_blank"),a.setAttribute("rel","noopener noreferrer"))}}),[e,r]),sanitizeHtml:o}},T=function(e,r){var i=t({top:0,left:0}),a=i[0],c=i[1],l=t(!1),u=l[0],d=l[1],m=n((function(t){if(t.rangeCount&&"floating"===r){var n=t.getRangeAt(0).getBoundingClientRect(),o=e.current;if(o){var i=o.offsetHeight;c({top:n.top-i-10+window.scrollY,left:n.left+n.width/2}),d(!0)}}}),[e,r]);return o((function(){"floating"!==r&&d(!0)}),[r]),{toolbarPos:a,showToolbar:u,setShowToolbar:d,updateToolbarPosition:m}},R=[{id:"text",label:"Text",items:[{id:"bold",label:"Bold",icon:c,command:"bold"},{id:"italic",label:"Italic",icon:l,command:"italic"},{id:"underline",label:"Underline",icon:u,command:"underline"}]},{id:"heading",label:"Heading",items:[{id:"h1",label:"Heading 1",icon:d,command:"formatBlock",value:"h1"},{id:"h2",label:"Heading 2",icon:m,command:"formatBlock",value:"h2"}]},{id:"alignment",label:"Alignment",items:[{id:"alignLeft",label:"Align Left",icon:s,command:"justifyLeft"},{id:"alignCenter",label:"Center",icon:f,command:"justifyCenter"},{id:"alignRight",label:"Align Right",icon:g,command:"justifyRight"}]},{id:"lists",label:"Lists",items:[{id:"bullet",label:"Bullet List",icon:p,command:"insertUnorderedList"},{id:"ordered",label:"Numbered List",icon:v,command:"insertOrderedList"},{id:"quote",label:"Quote",icon:b,command:"formatBlock",value:"blockquote"}]},{id:"insert",label:"Insert",items:[{id:"link",label:"Link",icon:C,command:"createLink"},{id:"image",label:"Image",icon:h,command:"insertImage"},{id:"table",label:"Table",icon:x,command:"insertTable"}]}],L=r((function(t,n){var o=t.position,r=void 0===o?"top":o,i=t.style,a=void 0===i?"full":i,c=t.show,l=void 0===c||c,u=t.groups,d=void 0===u?R:u,m=t.activeCommands,s=void 0===m?new Set:m,f=t.onCommand,g=t.customItems,p=void 0===g?[]:g,v=t.className,b=void 0===v?"":v;if(!l)return null;var C="\n    flex flex-wrap items-center gap-2 bg-white border border-gray-200\n    ".concat("floating"===r?"rounded-lg shadow-lg p-2":"p-2 border-t-0 border-x-0","\n    ").concat("compact"===a?"space-x-1":"space-x-2","\n    ").concat(b,"\n  ");return e.createElement("div",{ref:n,className:C,role:"toolbar","aria-label":"Text editor toolbar"},d.map((function(t){return e.createElement("div",{key:t.id,className:"flex items-center gap-1",role:"group","aria-label":t.label},t.items.map((function(t){var n=t.icon;return e.createElement("button",{key:t.id,type:"button",className:"\n                  p-1.5 rounded-md transition-colors\n                  ".concat(s.has(t.command)?"bg-gray-200 text-blue-600":"hover:bg-gray-100 text-gray-700","\n                "),onClick:function(){return e=t.command,n=t.value,void("createLink"!==e?"insertImage"!==e?f(e,n):(o=prompt("Enter image URL:"))&&f(e,o):(o=prompt("Enter URL:"))&&f(e,o));var e,n,o},title:t.label,"aria-pressed":s.has(t.command)},n&&e.createElement(n,{size:16}))})),t.id!==d[d.length-1].id&&e.createElement("div",{className:"w-px h-6 bg-gray-200 mx-1"}))})),p.length>0&&e.createElement(e.Fragment,null,e.createElement("div",{className:"w-px h-6 bg-gray-200 mx-1"}),e.createElement("div",{className:"flex items-center gap-1"},p.map((function(t){var n=t.icon;return e.createElement("button",{key:t.id,type:"button",className:"p-1.5 rounded-md hover:bg-gray-100 text-gray-700",onClick:t.onClick,title:t.label},n&&e.createElement(n,{size:16}))})))))}));L.displayName="Toolbar";var S=function(){return S=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},S.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var w,O,N,A,k,H=["p","br","strong","em","u","h1","h2","h3","ul","ol","li","a","img","blockquote","code","pre","div","span"],U=["href","src","alt","class","target","rel","style","data-*"],D=["color","background-color","text-align","font-size","font-family","margin","padding"],I={ALLOWED_TAGS:H,ALLOWED_ATTR:U,ALLOWED_STYLES:D,RETURN_DOM:!1,RETURN_DOM_FRAGMENT:!1,RETURN_TRUSTED_TYPE:!1},B=function(e){var t=a.sanitize(e,S(S({},I),{RETURN_DOM:!1,RETURN_DOM_FRAGMENT:!1}));return"string"==typeof t?t:""},j=function(e){try{return new URL(e),!0}catch(e){return!1}};!function(e){e.BOLD="bold",e.ITALIC="italic",e.UNDERLINE="underline",e.STRIKETHROUGH="strikeThrough",e.SUBSCRIPT="subscript",e.SUPERSCRIPT="superscript"}(w||(w={})),function(e){e.PARAGRAPH="p",e.H1="h1",e.H2="h2",e.H3="h3",e.H4="h4",e.BLOCKQUOTE="blockquote",e.CODE="pre"}(O||(O={})),function(e){e.LEFT="justifyLeft",e.CENTER="justifyCenter",e.RIGHT="justifyRight",e.JUSTIFY="justifyFull"}(N||(N={})),function(e){e.ORDERED="insertOrderedList",e.UNORDERED="insertUnorderedList"}(A||(A={})),function(e){e.FONT="fontName",e.SIZE="fontSize",e.COLOR="foreColor",e.BACKGROUND="backColor"}(k||(k={}));var q=function(){var e={textCommands:new Set};return Object.values(w).forEach((function(t){document.queryCommandState(t)&&e.textCommands.add(t)})),Object.values(N).forEach((function(t){document.queryCommandState(t)&&(e.alignCommand=t)})),Object.values(A).forEach((function(t){document.queryCommandState(t)&&(e.listCommand=t)})),e.fontName=document.queryCommandValue(k.FONT),e.fontSize=document.queryCommandValue(k.SIZE),e.textColor=document.queryCommandValue(k.COLOR),e.backgroundColor=document.queryCommandValue(k.BACKGROUND),e},z=function(e){return document.execCommand(e,!1)},F=function(e){return document.execCommand("formatBlock",!1,"<".concat(e,">"))},_=function(e){return document.execCommand(k.FONT,!1,e)},M=function(e){return document.execCommand(k.SIZE,!1,e)},P=function(e){return document.execCommand(k.COLOR,!1,e)},G=function(e){return document.execCommand(k.BACKGROUND,!1,e)},W=function(e){var t=e.url,n=e.text,o=e.newWindow,r=void 0===o||o,i=e.rel,a=void 0===i?"noopener noreferrer":i;return n?document.execCommand("insertHTML",!1,'<a href="'.concat(t,'" ').concat(r?'target="_blank"':"",' rel="').concat(a,'">').concat(n,"</a>")):document.execCommand("createLink",!1,t)},K=function(e){for(var t=e.rows,n=e.cols,o=e.width,r=void 0===o?"100%":o,i=e.cellPadding,a=void 0===i?"8px":i,c=e.border,l=void 0===c?"1px solid #ccc":c,u='<table style="width: '.concat(r,'; border-collapse: collapse;">'),d=0;d<t;d++){u+="<tr>";for(var m=0;m<n;m++)u+='<td style="padding: '.concat(a,"; border: ").concat(l,';">&nbsp;</td>');u+="</tr>"}return u+="</table>",document.execCommand("insertHTML",!1,u)},V=function(){var e=window.getSelection();if(!e||!e.rangeCount)return null;var t=e.getRangeAt(0);return{startOffset:t.startOffset,endOffset:t.endOffset,text:t.toString()}},Y=function(){return document.execCommand("insertLineBreak",!1)},Z=function(){return document.execCommand("insertParagraph",!1)},Q=function(){return document.execCommand("indent",!1)},J=function(){return document.execCommand("outdent",!1)},X=function(){return document.execCommand("copy",!1)},$=function(){return document.execCommand("cut",!1)},ee=function(){var e;return document.execCommand("insertText",!1,(null===(e=event.clipboardData)||void 0===e?void 0:e.getData("text/plain"))||"")},te=function(){return document.execCommand("undo",!1)},ne=function(){return document.execCommand("redo",!1)},oe=function(){return document.execCommand("removeFormat",!1)},re=function(){return document.execCommand("selectAll",!1)},ie=function(e){return document.queryCommandState(e)},ae=function(e){return document.queryCommandValue(e)},ce={paragraph:"p",headings:["h1","h2","h3"],inlineStyles:["bold","italic","underline","strikethrough"],alignment:["justifyLeft","justifyCenter","justifyRight"],lists:["insertUnorderedList","insertOrderedList"]},le=function(){var e=new Set;return ce.inlineStyles.forEach((function(t){ie(t)&&e.add(t)})),ce.alignment.forEach((function(t){ie(t)&&e.add(t)})),e},ue=function(){var e={},t=window.getSelection();if(t&&t.rangeCount>0){var n=t.getRangeAt(0).startContainer.parentElement;if(n){var o=window.getComputedStyle(n);e.fontFamily=o.fontFamily,e.fontSize=o.fontSize,e.color=o.color,e.backgroundColor=o.backgroundColor}}return e},de=function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.querySelectorAll("p").forEach((function(e){var t;(null===(t=e.textContent)||void 0===t?void 0:t.trim())||e.remove()})),t.innerHTML.replace(/\s+/g," ").trim()},me=function(e){var t=(new Option).style;return t.color=e,""!==t.color},se=function(e){return["px","em","rem","%","pt"].some((function(t){return e.endsWith(t)}))&&!isNaN(parseFloat(e))},fe=function(t){var r=t.initialContent,a=void 0===r?"":r,c=t.onChange,l=t.onSelectionChange,u=t.onFocus,d=t.onBlur,m=t.toolbar,s=void 0===m?{}:m,f=t.options,g=void 0===f?{}:f,p=t.theme,v=void 0===p?{}:p,b=t.className,C=void 0===b?"":b,h=i(null),x=i(null),S=y(a);S.content;var w=S.selection,O=S.updateContent,N=S.updateSelection,A=E(h,w),k=A.executeCommand;A.sanitizeHtml;var H=T(x,s.position||"top"),U=H.toolbarPos,D=H.showToolbar,I=H.setShowToolbar,j=H.updateToolbarPosition;o((function(){if(h.current&&a){var e=!1!==g.sanitize?B(a):a;h.current.innerHTML=e,O(e)}}),[a,g.sanitize]);var q=n((function(){if(h.current){var e=h.current.innerHTML,t=!1!==g.sanitize?B(e):e;O(t),null==c||c({html:t,plainText:h.current.innerText,wordCount:h.current.innerText.trim().split(/\s+/).length})}}),[c,g.sanitize]),z=n((function(){var e=window.getSelection();e&&(N(),null==l||l({range:e.rangeCount>0?e.getRangeAt(0):null,text:e.toString()}),"floating"===s.position&&(e.toString().trim()?j(e):I(!1)))}),[l,s.position]);return e.createElement("div",{className:"wysiwyg-editor ".concat(C)},e.createElement(L,{ref:x,groups:s.groups||R,customItems:s.customItems,position:s.position,style:s.style,show:D,pos:U,onCommand:k,theme:v.toolbar}),e.createElement("div",{ref:h,className:"wysiwyg-content ".concat(v.editor||""),contentEditable:!g.readOnly,onInput:q,onSelect:z,onFocus:u,onBlur:function(e){s.hideOnBlur&&setTimeout((function(){var e;(null===(e=x.current)||void 0===e?void 0:e.contains(document.activeElement))||I(!1)}),100),null==d||d(e)},style:{minHeight:g.minHeight||"200px",maxHeight:g.maxHeight},"data-placeholder":g.placeholder,suppressContentEditableWarning:!0}))},ge=L;export{U as ALLOWED_ATTR,D as ALLOWED_STYLES,H as ALLOWED_TAGS,N as AlignCommand,O as BlockCommand,ce as DEFAULT_FORMATS,fe as Editor,k as FormatCommand,A as ListCommand,w as TextCommand,ge as Toolbar,oe as clearFormatting,X as copySelection,W as createLink,K as createTable,$ as cutSelection,F as formatBlock,z as formatText,le as getActiveFormats,q as getFormatState,ae as getFormatValue,V as getSelection,ue as getSelectionStyles,Q as indent,Y as insertLineBreak,Z as insertParagraph,ie as isFormatActive,de as normalizeHtml,J as outdent,ee as pasteAsPlainText,ne as redo,I as sanitizeConfig,B as sanitizeHtml,re as selectAll,G as setBackgroundColor,_ as setFont,M as setFontSize,P as setTextColor,te as undo,E as useEditorCommands,y as useEditorState,T as useToolbar,me as validateColor,se as validateFontSize,j as validateUrl};
//# sourceMappingURL=index.esm.js.map
